<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started • hBayesDM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Getting Started">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hBayesDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting_started.html">Getting Started</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CCS-Lab/hBayesDM">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CCS-Lab/hBayesDM/blob/master/vignettes/getting_started.Rmd"><code>vignettes/getting_started.Rmd</code></a></small>
      <div class="hidden name"><code>getting_started.Rmd</code></div>

    </div>

    
    
<p>hBayesDM (<strong><em>h</em></strong>ierarchical <strong><em>Bayes</em></strong>ian modeling of <strong><em>D</em></strong>ecision-<strong><em>M</em></strong>aking tasks) is a user-friendly R package that offers hierarchical Bayesian analysis of various computational models on an array of decision-making tasks. Click <a href="https://cran.r-project.org/web/packages/hBayesDM/hBayesDM.pdf"><strong>here</strong></a> to download its help file (reference manual). Click <a href="https://www.mitpressjournals.org/doi/full/10.1162/CPSY_a_00002"><strong>here</strong></a> to read our paper published in Computational Psychiatry. Click <a href="https://u.osu.edu/ccsl/files/2016/12/hBayesDM_SRP_v1_revised-1qxbg1x.pdf"><strong>here</strong></a> to download a poster we presented at several conferences/meetings. You can find hBayesDM on <a href="https://cran.r-project.org/web/packages/hBayesDM/">CRAN</a> and <a href="https://github.com/CCS-Lab/hBayesDM">GitHub</a>.</p>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>Computational modeling provides a quantitative framework for investigating latent neurocognitive processes (e.g., learning rate, reward sensitivity) and interactions among multiple decision-making systems. Parameters of a computational model reflect psychologically meaningful individual differences: thus, getting accurate parameter estimates of a computational model is critical to improving the interpretation of its findings. Hierarchical Bayesian analysis (HBA) is regarded as the gold standard for parameter estimation, especially when the amount of information from each participant is small (see below “Why hierarchical Bayesian analysis?”). However, many researchers interested in HBA often find the approach too technical and challenging to be implemented.</p>
<p>We introduce a free R package <strong>hBayesDM</strong>, which offers HBA of various computational models on an array of decision-making tasks (see below for a list of tasks and models currently available). <em><strong>Users can perform HBA of various computational models with a single line of coding</strong></em>. Example datasets are also available. With hBayesDM, we hope anyone with minimal knowledge of programming can take advantage of advanced computational modeling and HBA. It is our expectation that hBayesDM will contribute to the dissemination of these computational tools and enable researchers in related fields to easily characterize latent neurocognitive processes within their study populations.</p>
</div>
<div id="why-hierarchical-bayesian-analysis-hba" class="section level2">
<h2 class="hasAnchor">
<a href="#why-hierarchical-bayesian-analysis-hba" class="anchor"></a>Why hierarchical Bayesian analysis (HBA)?</h2>
<p><img src="images/HBA_concept.png"></p>
<p>Most computational models do not have closed form solutions and we need to estimate parameter values. Traditionally parameters are estimated at the individual level with maximum likelihood estimation (MLE): getting point estimates for each individual separately. However, individual MLE estimates are often noisy especially when there is insufficient amount of data. A group-level analysis (e.g., group-level MLE), which estimate a single set of parameters for the whole group of individuals, may generate more reliable estimates but inevitably ignores individual differences.</p>
<p>HBA and other hierarchical approaches <span class="citation">(e.g., Huys et al., 2011)</span> allow for individual differences while pooling information across individuals. Both individual and group parameter estimates (i.e., posterior distributions) are estimated simultaneously in a mutually constraining fashion. Consequently, individual parameter estimates tend to be more stable and reliable because commonalities among individuals are captured and informed by the group tendencies <span class="citation">(e.g., Ahn et al., 2011)</span>. HBA also finds full posterior distributions instead of point estimates (thus providing rich information about the parameters). HBA also makes it easy to do group comparisons in a Bayesian fashion (e.g., comparing clinical and non-clinical groups, see an example below).</p>
<p>HBA is a branch of Bayesian statistics and the conceptual framework of Bayesian data analysis is clearly written in <a href="https://sites.google.com/site/doingbayesiandataanalysis/sample-chapter/DoingBayesianDataAnalysisChapter2.pdf">Chapter 2</a> of John Kruschke’s book <span class="citation">(Kruschke, 2014)</span>. In Bayesian statistics, we assume prior beliefs (i.e., prior distributions) for model parameters and update the priors into posterior distributions given the data (e.g., trial-by-trial choices and outcomes) using <a href="https://en.wikipedia.org/wiki/Bayes%27_rule">Bayes’ rule</a>. Note that the prior distributions we use for model parameters are vague (e.g., flat) or weakly informative priors, so they play a minimal role in the posterior distribution.</p>
<p>For Bayesian updating, we use the Stan software package (<a href="http://mc-stan.org/" class="uri">http://mc-stan.org/</a>), which implements a very efficient Markov Chain Monte Carlo (MCMC) algorithm called Hamiltonian Monte Carlo (HMC). HMC is known to be effective and works well even for large complex models. See Stan reference manual (<a href="http://mc-stan.org/documentation/" class="uri">http://mc-stan.org/documentation/</a>) and Chapter 14 of <span class="citation">Kruschke (2014)</span> for a comprehensive description of HMC and Stan. What is MCMC and why shoud we use it? Remember, we need to update our priors into posterior distributions in order to make inference about model parameters. Simply put, MCMC is a way of approximating a posterior distribution by drawing a large number of samples from it. MCMC algorithms are used when posterior distributions cannot be analytically achieved or using MCMC is more efficient than searching for the whole grid of parameter space (i.e., grid search). To learn more about the basic foundations of MCMC, we recommend Chapter 7 of <span class="citation">Kruschke (2014)</span>.</p>
<p>Detailed specification of Bayesian models is not available in text yet (stay tuned for our tutorial paper whose citation is listed below). At the same time, users can go over our Stan codes to check how we implement each computational model (e.g., <code>pathTo_gng_m1 = system.file("stan/gng_m1.stan", package="hBayesDM")</code> ). We made strong efforts to optimize Stan codes through reparameterization (e.g., Matt trick) and vectorization.</p>
</div>
<div id="prerequisites" class="section level2">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<ul>
<li>R version 3.4.0 or later is required. R is freely available from <a href="http://www.r-project.org/" class="uri">http://www.r-project.org/</a>.</li>
<li>
<strong>Latest Stan (RStan 2.18.1 or later)</strong>. Detailed instructions for installing RStan is available in this link: <a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started/" class="uri">https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started/</a>.</li>
<li>RStudio (<a href="https://www.rstudio.com/products/RStudio/" class="uri">https://www.rstudio.com/products/RStudio/</a>) is not required but strongly recommended.</li>
</ul>
<p><strong>Note</strong>: Additional R packages (e.g., <a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a>, <a href="https://cran.r-project.org/web/packages/loo/">loo</a>) will be installed (if not installed yet) during the installation of hBayesDM.</p>
</div>
<div id="tasks-models-implemented-in-hbayesdm" class="section level2">
<h2 class="hasAnchor">
<a href="#tasks-models-implemented-in-hbayesdm" class="anchor"></a>Tasks &amp; models implemented in hBayesDM</h2>
<p>See <a href="http://ccs-lab.github.io/hBayesDM/reference/index.html">here</a> for the list of tasks and models implemented in hBayesDM.</p>
</div>
<div id="how-to-install-hbayesdm" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-install-hbayesdm" class="anchor"></a>How to install hBayesDM</h2>
<p>There are three ways to install hBayesDM as described below. <em>Make sure to install <a href="http://mc-stan.org/interfaces/rstan">RStan</a> prior to install hBayesDM. And restart R/RStudio after the installation of hBayesDM.</em> Typically RStan can be installed just by typing <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("rstan", dependencies = TRUE)</a></code>. <strong>For Windows, you need to install <a href="https://github.com/stan-dev/rstan/wiki/Install-Rtools-for-Windows" target="_blank">Rtools</a> first to install RStan and install the hBayesDM from CRAN</strong>. For detailed instructions for the installation of rstan, please go to this link: <a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started" class="uri">https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started</a>. If you are a Mac user, <a href="https://github.com/stan-dev/rstan/wiki/RStan-Mac-OS-X-Prerequisite-Installation-Instructions#step2_3">make sure Xcode is installed</a>.</p>
<p>How can you tell if RStan is correctly installed? Check if you can fit the <a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started#example-1-eight-schools" target="_blank">‘Eight Schools’</a> model without a problem. Check <a href="http://mc-stan.org/interfaces/rstan.html">here</a> or <a href="https://groups.google.com/forum/#!categories/stan-users/installation" target="_blank">here</a> if you experience difficulty installing RStan.</p>
<div id="method-a-recommended-for-all-users---windowsmaclinux" class="section level3">
<h3 class="hasAnchor">
<a href="#method-a-recommended-for-all-users---windowsmaclinux" class="anchor"></a>Method A (recommended for all users - Windows/Mac/Linux)</h3>
<p>Use the following call:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"hBayesDM"</span>, <span class="dt">dependencies=</span><span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="method-b" class="section level3">
<h3 class="hasAnchor">
<a href="#method-b" class="anchor"></a>Method B</h3>
<p>Install the package from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">## install 'devtools' if required</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="cf">if</span> (<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(devtools)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)  </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"CCS-Lab/hBayesDM"</span>)</a></code></pre></div>
</div>
<div id="method-c" class="section level3">
<h3 class="hasAnchor">
<a href="#method-c" class="anchor"></a>Method C</h3>
<ol style="list-style-type: decimal">
<li>Download a copy from <a href="https://cran.r-project.org/src/contrib/hBayesDM_1.0.0.tar.gz"><strong>here</strong></a> to a directory (e.g., “~/Downloads”).</li>
<li>Open R(Studio) and set working directory to the downloaded folder. (e.g., <code><a href="https://rdrr.io/r/base/getwd.html">setwd("~/Downloads")</a></code> )</li>
<li>Install the package from the downloaded file.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="dt">pkgs=</span><span class="st">"hBayesDM_1.0.0.tar.gz"</span>, <span class="dt">dependencies=</span><span class="ot">TRUE</span>, <span class="dt">repos=</span><span class="ot">NULL</span>)</a></code></pre></div>
</div>
<div id="precompiling-stan-models-during-installation" class="section level3">
<h3 class="hasAnchor">
<a href="#precompiling-stan-models-during-installation" class="anchor"></a>Precompiling Stan models during installation</h3>
<p>If you follow the direction described below, Stan models will be precompiled during installation and models will run immediately when called. This is recommended if you are a frequent hBayesDM user!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span>(<span class="dt">BUILD_ALL=</span><span class="st">'true'</span>)  <span class="co"># Build all the models on installation</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span>(<span class="dt">MAKEFLAGS=</span><span class="st">'-j 4'</span>)  <span class="co"># Use 4 cores for compilation (or the number you want)</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"hBayesDM"</span>)  <span class="co"># Install from CRAN</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">## or</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"CCS-Lab/hBayesDM"</span>)  <span class="co"># Install from GitHub</span></a></code></pre></div>
<p><strong>We highly recommend you use multiple cores for compiling, since it will take quite a long time to complete.</strong></p>
</div>
</div>
<div id="how-to-use-hbayesdm" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-use-hbayesdm" class="anchor"></a>How to use hBayesDM</h2>
<p>First, open RStudio (or just R) and load the package:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(hBayesDM)</a></code></pre></div>
<p>Four steps of doing HBA with hBayesDM are illustrated below. As an example, four models of the orthogonalized Go/Nogo task (Guitart-Masip et al., 2012; Cavanagh et al., 2013) are fit and compared with the hBayesDM package.</p>
<p><img src="images/hBayesDM_pipeLine.png"></p>
<div id="prepare-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#prepare-the-data" class="anchor"></a>1) Prepare the data</h3>
<ul>
<li>For fitting a model with hBayesDM, all subjects’ data should be combined into a single text (*.txt) file. Look at the sample dataset and a help file (e.g., <code><a href="../reference/gng_m1.html">?gng_m1</a></code>) for each task and carefully follow the instructions.</li>
<li>Subjects’ data must contain variables that are consistent with the column names specified in the help file, though extra variables are in practice allowed.</li>
<li>It is okay if the number of trials is different across subjects. But there should exist no N/A data. If some trials contain N/A data (e.g., <code>choice=NA</code> in trial#10), remove the trials first.</li>
<li>Sample data are available <a href="https://u.osu.edu/ccsl/files/2016/03/sampleData_hBayesDM_0.2.0-1d9qdvj.zip"><strong>here</strong></a>, although users can fit a model with sample data without separately downloading them with one of the function arguments. Once the hBayesDM package is installed, sample data can be also retrieved from the package folder. Note that the file name of sample (example) data for a given task is <strong>taskName_exampleData.txt</strong> (e.g., dd_exampleData.txt, igt_exampleData.txt, gng_exampleData.txt, etc.). See each model’s help file (e.g., <code><a href="../reference/gng_m1.html">?gng_m1</a></code>) to check required data columns and their labels.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">dataPath =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/gng_exampleData.txt"</span>, <span class="dt">package=</span><span class="st">"hBayesDM"</span>)</a></code></pre></div>
<p>If you download the sample data to “~/Downloads”, you may specify the path to the data file like this:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">dataPath =<span class="st"> "~/Downloads/gng_exampleData.txt"</span></a></code></pre></div>
</div>
<div id="fit-candidate-models" class="section level3">
<h3 class="hasAnchor">
<a href="#fit-candidate-models" class="anchor"></a>2) Fit candidate models</h3>
<p>Below the <code>gng_m1</code> model is fit with its sample data. The command indicates that three MCMC chains are run and three cores are used for parallel computing. If you enter “example” as an argument for <code>data</code>, hBayesDM will use the sample data for the task. Note that you can save the output to a file (see the <code>saveDir</code> argument) or send an email when fitting is complete (see the <code>email</code> argument). You can also assign your own initial values (see the <code>inits</code> argument; e.g., <code>inits=c(0.1, 0.2, 1.0)</code>):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">output1 =<span class="st"> </span><span class="kw"><a href="../reference/gng_m1.html">gng_m1</a></span>(<span class="dt">data=</span><span class="st">"example"</span>, <span class="dt">niter=</span><span class="dv">2000</span>, <span class="dt">nwarmup=</span><span class="dv">1000</span>, <span class="dt">nchain=</span><span class="dv">4</span>, <span class="dt">ncore=</span><span class="dv">4</span>)</a></code></pre></div>
<p>, which is the same as the command below because the default numbers of total (including warmup) iterations (MCMC samples), warmup iterations, and chains are 2,000, 1,000, and 4 for <code>gng</code> models.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">output1 =<span class="st"> </span><span class="kw"><a href="../reference/gng_m1.html">gng_m1</a></span>(<span class="st">"example"</span>, <span class="dt">ncore=</span><span class="dv">4</span>)</a></code></pre></div>
<pre><code>## 
## Model name  = gng_m1 
## Data file   = example 
## 
## Details:
##  # of chains                    = 4 
##  # of cores used                = 4 
##  # of MCMC samples (per chain)  = 2000 
##  # of burn-in samples           = 1000 
##  # of subjects                  = 10 
##  # of (max) trials per subject  = 240 
## 
## 
## ****************************************
## ** Use VB estimates as initial values **
## ****************************************
## Chain 1: ------------------------------------------------------------
## Chain 1: EXPERIMENTAL ALGORITHM:
## Chain 1:   This procedure has not been thoroughly tested and may be unstable
## Chain 1:   or buggy. The interface is subject to change.
## Chain 1: ------------------------------------------------------------
## Chain 1: 
## Chain 1: 
## Chain 1: 
## Chain 1: Gradient evaluation took 0.001829 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 18.29 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Begin eta adaptation.
## Chain 1: Iteration:   1 / 250 [  0%]  (Adaptation)
## Chain 1: Iteration:  50 / 250 [ 20%]  (Adaptation)
## Chain 1: Iteration: 100 / 250 [ 40%]  (Adaptation)
## Chain 1: Iteration: 150 / 250 [ 60%]  (Adaptation)
## Chain 1: Iteration: 200 / 250 [ 80%]  (Adaptation)
## Chain 1: Success! Found best value [eta = 1] earlier than expected.
## Chain 1: 
## Chain 1: Begin stochastic gradient ascent.
## Chain 1:   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes 
## Chain 1:    100         -820.269             1.000            1.000
## Chain 1:    200         -810.308             0.506            1.000
## Chain 1:    300         -815.111             0.339            0.012
## Chain 1:    400         -809.368             0.256            0.012
## Chain 1:    500         -809.646             0.205            0.007   MEDIAN ELBO CONVERGED
## Chain 1: 
## Chain 1: Drawing a sample of size 1000 from the approximate posterior... 
## Chain 1: COMPLETED.</code></pre>
<pre><code>## Warning: Pareto k diagnostic value is 1.25. Resampling is disabled.
## Decreasing tol_rel_obj may help if variational algorithm has terminated
## prematurely. Otherwise consider using sampling instead.</code></pre>
<pre><code>## 
## ************************************
## **** Model fitting is complete! ****
## ************************************</code></pre>
<p>Executing the command will generate messages like below in the R console. It will take approximately 2~3 minutes (with the <code>gng_m1</code> model &amp; “example” data) for the model fitting to complete (with MCMC sampling). Note that you may get warning messages about “numerical problems” or that there are a certain number of “divergent transitions after warmup”. When we check our models with example datasets, warning messages appear mostly at the beginning of the warmup period and there are very few divergent transitions after warmup. In such cases, you can ignore the warnings. Also see Appendix D of the <a href="https://github.com/stan-dev/stan/releases/download/v2.17.0/stan-reference-2.17.0.pdf">Stan Reference Manual</a>.</p>
<pre><code>Model name  = gng_m1 
Data file   = example 

Details:
 # of chains                    = 4 
 # of cores used                = 4 
 # of MCMC samples (per chain)  = 2000 
 # of burn-in samples           = 1000 
 # of subjects                  = 10 
 # of (max) trials per subject  = 240 

****************************************
** Use VB estimates as initial values **
****************************************


***********************************
**  Loading a precompiled model  **
***********************************
starting worker pid=75130 on localhost:11950 at 08:25:48.905
starting worker pid=75138 on localhost:11950 at 08:25:49.101

SAMPLING FOR MODEL 'gng_m1' NOW (CHAIN 1).

Chain 1, Iteration:    1 / 2000 [  0%]  (Warmup)
SAMPLING FOR MODEL 'gng_m1' NOW (CHAIN 2).
...</code></pre>
<p>When model fitting is complete, you see this message and data are stored into <code>output1</code>.</p>
<pre><code>************************************
**** Model fitting is complete! ****
************************************</code></pre>
<p><code>output1</code>, a hBayesDM object, is a list with 4 elements (class: “hBayesDM”):</p>
<ol style="list-style-type: decimal">
<li>
<code>model</code>: Name of the fitted model (i.e., <code>output1$model</code> is ‘gng_m1’).</li>
<li>
<code>allIndPars</code>: Summary of individual subjects’ parameters (default: <em>mean</em>). Users can also choose to use <em>median</em> or <em>mode</em> (e.g., <code>output1 = gng_m1("example", indPars="mode")</code> ).</li>
<li>
<code>parVals</code>: Posterior samples of all parameters. Extracted by <code><a href="https://rdrr.io/pkg/rstan/man/stanfit-method-extract.html">rstan::extract(rstan_object, permuted=T)</a></code>. <strong>Note that hyper (group) mean parameters are indicated by <code>mu_PARAMETER</code> (e.g., <code>mu_xi</code>, <code>mu_ep</code>, <code>mu_rho</code>).</strong>
</li>
<li>
<code>fit</code>: RStan object (i.e., <code>fit = stan(file='gng_m1.stan', ...)</code> ).</li>
<li>
<code>rawdata</code>: Raw trial-by-trial data used for modeling. Raw data are provided in the output to allow users to easily access data and compare trial-by-trial model-based regressors (e.g., prediction errors) with choice data.</li>
<li>
<code>modelRegressor</code> (optional): Trial-by-trial model-based regressors such as prediction errors, the values of the chosen option, etc. For each model, we pre-select appropriate model-based regressors.</li>
</ol>
<pre><code>&gt; output1$allIndPars
           xi        ep      rho subjID
1  0.03688558 0.1397615 5.902901      1
2  0.02934812 0.1653435 6.066120      2
3  0.04467025 0.1268796 5.898099      3
4  0.02103926 0.1499842 6.185020      4
5  0.02620808 0.1498962 6.081908      5
...</code></pre>
<pre><code>&gt; output1$fit
Inference for Stan model: gng_m1.
4 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=4000, total post-warmup draws=4000.

               mean se_mean   sd    2.5%     25%     50%     75%   97.5% n_eff Rhat
mu_xi          0.03    0.00 0.02    0.00    0.02    0.03    0.05    0.08  2316 1.00
mu_ep          0.15    0.00 0.02    0.11    0.13    0.15    0.16    0.19  4402 1.00
mu_rho         5.97    0.01 0.72    4.76    5.45    5.89    6.40    7.61  3821 1.00
sigma[1]       0.54    0.06 1.02    0.02    0.18    0.35    0.61    1.99   318 1.01
sigma[2]       0.12    0.00 0.08    0.01    0.05    0.10    0.16    0.31  2620 1.00
sigma[3]       0.12    0.00 0.09    0.01    0.05    0.10    0.16    0.33  2402 1.00
...</code></pre>
<p><span class="math inline">\(\hat{R}\)</span> (<code>Rhat</code>) is an index of the convergence of the chains. <span class="math inline">\(\hat{R}\)</span> values close to 1.00 would indicate that MCMC chains are converged to stationary target distributions. When we check MCMC performance of our models on sample data, <span class="math inline">\(\hat{R}\)</span> values are 1.00 for most parameters or at most 1.04.</p>
</div>
<div id="plot-model-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-model-parameters" class="anchor"></a>3) Plot model parameters</h3>
<p>Make sure to visually diagnose MCMC performance (i.e., visually check whether MCMC samples are well mixed and converged to stationary distributions). For the diagnosis or visualization of hyper (group) parameters, you can use <code>plot.hBayesDM</code> or just <code>plot</code>, which searches for an extension function that contains the class name. The class of any hBayesDM output is <code>hBayesDM</code>:</p>
<p>Let’s first visually diagnose MCMC performance of hyper parameters with trace plots:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(output1, <span class="dt">type=</span><span class="st">"trace"</span>, <span class="dt">fontSize=</span><span class="dv">11</span>)   <span class="co"># traceplot of hyper parameters. Set font size 11.</span></a></code></pre></div>
<p><img src="getting_started_files/figure-html/unnamed-chunk-11-1.png"><!-- --></p>
<p>The trace plots indicate that MCMC samples are indeed well mixed and converged, which is consistent with their <span class="math inline">\(\hat{R}\)</span> values (see <a href="http://stats.stackexchange.com/questions/20437/why-should-we-care-about-rapid-mixing-in-mcmc-chains"><strong>here</strong></a> for some discussion on why we care about mixing). Note that the plots above exclude burn-in samples. If you want, you can include burn-in (warmup) MCMC samples.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(output1, <span class="dt">type=</span><span class="st">"trace"</span>, <span class="dt">inc_warmup=</span>T)   <span class="co"># traceplot of hyper parameters w/ warmup samples</span></a></code></pre></div>
<p><img src="getting_started_files/figure-html/unnamed-chunk-12-1.png"><!-- --></p>
<p>You can also plot the posterior distributions of the hyper (group) parameters with <code>plot</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(output1)</a></code></pre></div>
<p><img src="getting_started_files/figure-html/unnamed-chunk-13-1.png"><!-- --><!-- 
$\epsilon_i \sim \text{Normal}(0.05, 0.01)$
$\rho_{Rew_i} \sim \text{Normal}(0.05, 0.01)$
--></p>
<p>To visualize individual parameters, you can use our newly updated function called <code>plotInd</code> (based on Stan’s native function <code>stan_plot</code>). For example, to plot each individual’s <span class="math inline">\(\epsilon\)</span> (learning rate) parameter (e.g., individual posterior distributions):</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="../reference/plotInd.html">plotInd</a></span>(output1, <span class="st">"ep"</span>)  </a></code></pre></div>
<p><img src="getting_started_files/figure-html/unnamed-chunk-14-1.png"><!-- --></p>
<!--
Their posterior means are also stored in `OUTPUT_object$allIndPars`:

```r
output1$allIndPars
```

```
##    subjID         xi        ep      rho
## 1       1 0.03937858 0.1388763 5.991021
## 2       2 0.03602277 0.1614945 6.180092
## 3       3 0.04288713 0.1274827 5.941119
## 4       4 0.03170505 0.1484355 6.262789
## 5       5 0.03462090 0.1485741 6.184602
## 6       6 0.04236850 0.1536645 6.334553
## 7       7 0.04314376 0.1491778 5.797528
## 8       8 0.03471143 0.1611320 6.538876
## 9       9 0.03987275 0.1451317 6.083010
## 10     10 0.04784353 0.1302289 5.546315
```
-->
</div>
<div id="compare-models-and-groups" class="section level3">
<h3 class="hasAnchor">
<a href="#compare-models-and-groups" class="anchor"></a>4) Compare models (and groups)</h3>
<p>To compare models, you first fit all models in the same manner as the example above (e.g., <code>outpu4 = gng_m4("example", niter=2000, nwarmup=1000, nchain=4, ncore=4)</code> ). Next, we use the command <code>printFit</code>, which is a convenient way to summarize Leave-One-Out Information Criterion (LOOIC) or Widely Applicable Information Criterion (WAIC) of all models we consider (see <span class="citation">Vehtari et al. (2015)</span> for the details of LOOIC and WAIC). By default, <code>printFit</code> function uses the LOOIC which is preferable to the WAIC when there are influential observations <span class="citation">(Vehtari et al., 2015)</span>.</p>
<p>Assuming four models’ outputs are <code>output1</code> (gng_m1), <code>output2</code> (gng_m2), <code>output3</code> (gng_m3), and <code>output4</code> (gng_m4), their model fits can be simultaneously summarized by:</p>
<pre><code>&gt; printFit(output1, output2, output3, output4)
   Model    LOOIC   
1 gng_m1 1588.843 
2 gng_m2 1571.129 
3 gng_m3 1573.872 
4 gng_m4 1543.335 </code></pre>
<p>Note that the lower LOOIC is, the better its model-fit is. Thus, model#4 has the best LOOIC compared to other models. Users can print WAIC or both by calling <code><a href="../reference/printFit.html">printFit(output1, output2, output3, output4, ic="waic")</a></code> or <code><a href="../reference/printFit.html">printFit(output1, output2, output3, output4, ic="both")</a></code>. Use the <code>extract_ic</code> function (e.g., <code><a href="../reference/extract_ic.html">extract_ic(output3)</a></code> ) if you want more detailed information including standard errors and expected log pointwise predictive density (elpd). Note that the <code>extract_ic</code> function can be used only for a single model output.</p>
<p>We also want to remind you that there are multiple ways to compare computational models (e.g., simulation method (absolute model performance), parameter recovery, generalization criterion) and the goodness of fit (e.g., LOOIC or WAIC) is just one of them. Check if predictions from your model (e.g., “posterior predictive check”) can mimic the data (same data or new data) with reasonable accuracy. See <span class="citation">Kruschke (2014)</span> (for posterior predictive check), Guitart-Masip et al. (2012) (for goodness of fit and simulation performance on the orthogonalized Go/Nogo task), and <span class="citation">Busemeyer &amp; Wang (2000)</span> (for generalization criterion) as well as Ahn et al. (2008; 2014) and <span class="citation">Steingroever et al. (2014)</span> (for the combination of multiple model comparison methods).</p>
<p>To compare two groups in a Bayesian fashion <span class="citation">(e.g., Ahn et al., 2014)</span>, first you need to fit each group with the same model and ideally the same number of MCMC samples. For example,</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">data_group1 =<span class="st"> "~/Project_folder/gng_data_group1.txt"</span>  <span class="co"># data file for group1</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">data_group2 =<span class="st"> "~/Project_folder/gng_data_group2.txt"</span>  <span class="co"># data file for group2</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"></a>
<a class="sourceLine" id="cb22-4" data-line-number="4">output_group1 =<span class="st"> </span><span class="kw"><a href="../reference/gng_m4.html">gng_m4</a></span>(data_group1)  <span class="co"># fit group1 data with the gng_m4 model </span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5">output_group2 =<span class="st"> </span><span class="kw"><a href="../reference/gng_m4.html">gng_m4</a></span>(data_group2)  <span class="co"># fit group2 data with the gng_m4 model </span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="co">## After model fitting is complete for both groups,</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">## evaluate the group difference (e.g., on the 'pi' parameter) by examining the posterior distribution of group mean differences.</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"></a>
<a class="sourceLine" id="cb22-10" data-line-number="10">diffDist =<span class="st"> </span>output_group1<span class="op">$</span>parVals<span class="op">$</span>mu_pi <span class="op">-</span><span class="st"> </span>output_group2<span class="op">$</span>parVals<span class="op">$</span>mu_pi  <span class="co"># group1 - group2 </span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="kw"><a href="../reference/HDIofMCMC.html">HDIofMCMC</a></span>( diffDist )  <span class="co"># Compute the 95% Highest Density Interval (HDI). </span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="kw"><a href="../reference/plotHDI.html">plotHDI</a></span>( diffDist )    <span class="co"># plot the group mean differences</span></a></code></pre></div>
</div>
<div id="extracting-trial-by-trial-regressors-for-model-based-fmrieeg-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#extracting-trial-by-trial-regressors-for-model-based-fmrieeg-analysis" class="anchor"></a>5) Extracting trial-by-trial regressors for model-based fMRI/EEG analysis</h3>
<p>In model-based neuroimaging <span class="citation">(e.g., O’Doherty et al., 2007)</span>, model-based time series of a latent cognitive process are generated by computational models, and then time series data are convolved with a hemodynamic response function and regressed again fMRI or EEG data. This model-based neuroimaging approach has been particularly popular in cognitive neuroscience.</p>
<p>The biggest challenge for performing model-based fMRI/EEG is to learn how to extract trial-by-trial model-based regressors. The hBayesDM package allows users to easily extract model-based regressors that can be used for model-based fMRI or EEG analysis. The hBayesDM package currently provides the following model-based regressors. With the trial-by-trial regressors, users can easily use their favorite neuroimaging package (e.g., in Statistical Parametric Mapping (SPM; <a href="http://www.fil.ion.ucl.ac.uk/spm/" class="uri">http://www.fil.ion.ucl.ac.uk/spm/</a>) to perform model-based fMRI analysis. See our <a href="https://www.mitpressjournals.org/doi/abs/10.1162/CPSY_a_00002">paper</a> (<strong>Extracting Trial-by-Trial Regressors for Model-Based fMRI/EEG Analysis</strong>) for more details.</p>
<p>As an example, if you would like to extract trial-by-trial stimulus values (i.e., expected value of stimulus on each trial), first fit a model like the follwoing (set the <code>modelRegressor</code> input variable to <code>TRUE</code>. Its default value is <code>FALSE</code>):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co">## fit example data with the gng_m3 model</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">output3 =<span class="st"> </span><span class="kw"><a href="../reference/gng_m3.html">gng_m3</a></span>(<span class="dt">data=</span><span class="st">"example"</span>, <span class="dt">niter=</span><span class="dv">2000</span>, <span class="dt">nwarmup=</span><span class="dv">1000</span>, <span class="dt">modelRegressor=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## 
## Model name  = gng_m3 
## Data file   = example 
## 
## Details:
##  # of chains                    = 4 
##  # of cores used                = 4 
##  # of MCMC samples (per chain)  = 2000 
##  # of burn-in samples           = 1000 
##  # of subjects                  = 10 
##  # of (max) trials per subject  = 240 
## 
## **************************************
## **  Extract model-based regressors  **
## **************************************
## 
## 
## ****************************************
## ** Use VB estimates as initial values **
## ****************************************
## Chain 1: ------------------------------------------------------------
## Chain 1: EXPERIMENTAL ALGORITHM:
## Chain 1:   This procedure has not been thoroughly tested and may be unstable
## Chain 1:   or buggy. The interface is subject to change.
## Chain 1: ------------------------------------------------------------
## Chain 1: 
## Chain 1: 
## Chain 1: 
## Chain 1: Gradient evaluation took 0.00253 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 25.3 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Begin eta adaptation.
## Chain 1: Iteration:   1 / 250 [  0%]  (Adaptation)
## Chain 1: Iteration:  50 / 250 [ 20%]  (Adaptation)
## Chain 1: Iteration: 100 / 250 [ 40%]  (Adaptation)
## Chain 1: Iteration: 150 / 250 [ 60%]  (Adaptation)
## Chain 1: Iteration: 200 / 250 [ 80%]  (Adaptation)
## Chain 1: Success! Found best value [eta = 1] earlier than expected.
## Chain 1: 
## Chain 1: Begin stochastic gradient ascent.
## Chain 1:   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes 
## Chain 1:    100         -823.918             1.000            1.000
## Chain 1:    200         -826.958             0.502            1.000
## Chain 1:    300         -814.838             0.340            0.015
## Chain 1:    400         -818.443             0.256            0.015
## Chain 1:    500         -817.985             0.205            0.004   MEDIAN ELBO CONVERGED
## Chain 1: 
## Chain 1: Drawing a sample of size 1000 from the approximate posterior... 
## Chain 1: COMPLETED.</code></pre>
<pre><code>## Warning: Pareto k diagnostic value is 1.14. Resampling is disabled.
## Decreasing tol_rel_obj may help if variational algorithm has terminated
## prematurely. Otherwise consider using sampling instead.</code></pre>
<pre><code>## 
## ************************************
## **** Model fitting is complete! ****
## ************************************</code></pre>
<p>Once the sampling is completed, all model-based regressors are contained in the <code>modelRegressor</code> list.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co">## store all subjects' stimulus value (SV) in ‘sv_all’</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">sv_all =<span class="st"> </span>output3<span class="op">$</span>modelRegressor<span class="op">$</span>SV </a>
<a class="sourceLine" id="cb27-3" data-line-number="3"></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(output3<span class="op">$</span>modelRegressor<span class="op">$</span>SV)  <span class="co"># number of rows=# of subjects (=10), number of columns=# of trials (=240)</span></a></code></pre></div>
<pre><code>## [1]  10 240</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co">## visualize SV (Subject #1)</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(sv_all[<span class="dv">1</span>, ], <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">xlab=</span><span class="st">"Trial"</span>, <span class="dt">ylab=</span><span class="st">"Stimulus Value (subject #1)"</span>)  </a></code></pre></div>
<p><img src="getting_started_files/figure-html/unnamed-chunk-20-1.png"><!-- --></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co">## visualize SV (Subject #5)</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(sv_all[<span class="dv">5</span>, ], <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">xlab=</span><span class="st">"Trial"</span>, <span class="dt">ylab=</span><span class="st">"Stimulus Value (subject #5)"</span>)  </a></code></pre></div>
<p><img src="getting_started_files/figure-html/unnamed-chunk-20-2.png"><!-- --></p>
<p>Similarly, users can extract and visualize other model-based regressors. <strong>W(Go)</strong>, <strong>W(NoGo)</strong>, <strong>Q(Go)</strong>, <strong>Q(NoGo)</strong> are stored in <code>Wgo</code>, <code>Wnogo</code>, <code>Qgo</code>, and <code>Qnogo</code>, respectively.</p>
</div>
<div id="variational-inference-for-approximate-posterior-sampling" class="section level3">
<h3 class="hasAnchor">
<a href="#variational-inference-for-approximate-posterior-sampling" class="anchor"></a>6) Variational inference for approximate posterior sampling</h3>
<p>To use Stan’s variational algorithm for approximate posterior sampling in hBayesDM, users just need to set <code>vb=TRUE</code> (default = <code>FALSE</code>). It takes very little time (especially with precompiled models) to do variational inference - try it yourself for any model!! But variational inference should be used only to get a rough estimate. It is recommended that users use MCMC for final inferences.</p>
<p>For example, to run <code>gng_m1</code> using variational inference:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co">## fit example data with the gng_m3 model</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2">output3 =<span class="st"> </span><span class="kw"><a href="../reference/gng_m3.html">gng_m3</a></span>(<span class="dt">data=</span><span class="st">"example"</span>, <span class="dt">vb =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Note that input arguments for MCMC sampling (e.g., <code>nchain</code>, <code>niter</code>, <code>nthin</code>, <code>nwarmup</code>) are not specified here. <code><a href="https://rdrr.io/pkg/rstan/man/stanmodel-method-vb.html">?rstan::vb</a></code> for more details.</p>
</div>
<div id="posterior-predictive-checks" class="section level3">
<h3 class="hasAnchor">
<a href="#posterior-predictive-checks" class="anchor"></a>7) Posterior predictive checks</h3>
<p>Simply put, <em>posterior predictive checks</em> refer to when a fitted model is used to generate simulated data and check if simulated data are similar to the actual data. Posterior predictive checks are useful in assessing if a model generates valid predictions.</p>
<p>From v0.5.0, users can run posterior predictive checks on all models except drift-diffusion models in hBayesDM. Simulated data from posterior predictive checks are contained in <code>hBayesDM_OUTPUT$parVals$y_pred</code>. In a future release, we will include a function/command that can conveniently summarize and plot posterior predictive checks. In the mean time, users can program their own codes like the following:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="co">## fit example data with the gng_m3 model and run posterior predictive checks</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">x =<span class="st"> </span><span class="kw"><a href="../reference/gng_m3.html">gng_m3</a></span>(<span class="dt">data=</span><span class="st">"example"</span>, <span class="dt">niter=</span><span class="dv">2000</span>, <span class="dt">nwarmup=</span><span class="dv">1000</span>, <span class="dt">nchain=</span><span class="dv">4</span>, <span class="dt">ncore=</span><span class="dv">4</span>, <span class="dt">inc_postpred =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3"></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="co">## dimension of x$parVals$y_pred</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(x<span class="op">$</span>parVals<span class="op">$</span>y_pred)   <span class="co"># y_pred --&gt; 4000 (MCMC samples) x 10 (subjects) x 240 (trials)</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6">[<span class="dv">1</span>] <span class="dv">4000</span>  <span class="dv">10</span>  <span class="dv">240</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7"></a>
<a class="sourceLine" id="cb32-8" data-line-number="8">y_pred_mean =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(x<span class="op">$</span>parVals<span class="op">$</span>y_pred, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>,<span class="dv">3</span>), mean)  <span class="co"># average of 4000 MCMC samples</span></a>
<a class="sourceLine" id="cb32-9" data-line-number="9"></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(y_pred_mean)  <span class="co"># y_pred_mean --&gt; 10 (subjects) x 240 (trials)</span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11">[<span class="dv">1</span>]  <span class="dv">10</span> <span class="dv">240</span></a>
<a class="sourceLine" id="cb32-12" data-line-number="12"></a>
<a class="sourceLine" id="cb32-13" data-line-number="13">numSubjs =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(x<span class="op">$</span>allIndPars)[<span class="dv">1</span>]  <span class="co"># number of subjects</span></a>
<a class="sourceLine" id="cb32-14" data-line-number="14"></a>
<a class="sourceLine" id="cb32-15" data-line-number="15">subjList =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(x<span class="op">$</span>rawdata<span class="op">$</span>subjID)  <span class="co"># list of subject IDs</span></a>
<a class="sourceLine" id="cb32-16" data-line-number="16">maxT =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(x<span class="op">$</span>rawdata<span class="op">$</span>subjID))  <span class="co"># maximum number of trials</span></a>
<a class="sourceLine" id="cb32-17" data-line-number="17">true_y =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="ot">NA</span>, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(numSubjs, maxT)) <span class="co"># true data (`true_y`)</span></a>
<a class="sourceLine" id="cb32-18" data-line-number="18"></a>
<a class="sourceLine" id="cb32-19" data-line-number="19"><span class="co">## true data for each subject</span></a>
<a class="sourceLine" id="cb32-20" data-line-number="20"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numSubjs) {</a>
<a class="sourceLine" id="cb32-21" data-line-number="21">  tmpID =<span class="st"> </span>subjList[i]</a>
<a class="sourceLine" id="cb32-22" data-line-number="22">  tmpData =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(x<span class="op">$</span>rawdata, subjID <span class="op">==</span><span class="st"> </span>tmpID)</a>
<a class="sourceLine" id="cb32-23" data-line-number="23">  true_y[i, ] =<span class="st"> </span>tmpData<span class="op">$</span>keyPressed  <span class="co"># only for data with a 'choice' column</span></a>
<a class="sourceLine" id="cb32-24" data-line-number="24">}</a>
<a class="sourceLine" id="cb32-25" data-line-number="25"></a>
<a class="sourceLine" id="cb32-26" data-line-number="26"><span class="co">## Subject #1</span></a>
<a class="sourceLine" id="cb32-27" data-line-number="27"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(true_y[<span class="dv">1</span>, ], <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">xlab=</span><span class="st">"Trial"</span>, <span class="dt">ylab=</span><span class="st">"Choice (0 or 1)"</span>, <span class="dt">yaxt=</span><span class="st">"n"</span>)</a>
<a class="sourceLine" id="cb32-28" data-line-number="28"><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(y_pred_mean[<span class="dv">1</span>,], <span class="dt">col=</span><span class="st">"red"</span>, <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb32-29" data-line-number="29"><span class="kw"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="dt">side=</span><span class="dv">2</span>, <span class="dt">at =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>) )</a>
<a class="sourceLine" id="cb32-30" data-line-number="30"><span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomleft"</span>, <span class="dt">legend=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"True"</span>, <span class="st">"PPC"</span>), <span class="dt">col=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"red"</span>), <span class="dt">lty=</span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="images/PPC.png"></p>
</div>
</div>
<div id="to-do-list" class="section level2">
<h2 class="hasAnchor">
<a href="#to-do-list" class="anchor"></a>To-do list</h2>
<p>We are planning to add more tasks/models. We plan to include the following tasks and/or models in the near future. If you have any requests for a specific task or a model, please let us know.</p>
<ul>
<li>Hierarchical Gaussian Filtering <span class="citation">(Mathys et al., 2011)</span>.</li>
<li>More sequential sampling models (e.g., drift diffusion models with different drift rates for multiple conditions).</li>
<li>Models for the passive avoidance learning task <span class="citation">(Newman &amp; Kosson, 1986; Newman et al., 1985)</span>.</li>
<li>Models for the Stop Signal Task (SST)</li>
<li>Allowing users to extract model-based regressors <span class="citation">(O’Doherty et al., 2007)</span> from more tasks.</li>
</ul>
</div>
<div id="citation" class="section level2">
<h2 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h2>
<p>If you used hBayesDM or some of its codes for your research, please cite <a href="https://www.mitpressjournals.org/doi/full/10.1162/CPSY_a_00002">this paper</a>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bibtex"><code class="sourceCode bibtex"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="va">@article</span>{<span class="ot">hBayesDM</span>,</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">  <span class="dt">title</span> = {Revealing Neurocomputational Mechanisms of Reinforcement Learning and Decision-Making With the {hBayesDM} Package},</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">  <span class="dt">author</span> = {Ahn, Woo-Young and Haines, Nathaniel and Zhang, Lei},</a>
<a class="sourceLine" id="cb33-4" data-line-number="4">  <span class="dt">journal</span> = {Computational Psychiatry},</a>
<a class="sourceLine" id="cb33-5" data-line-number="5">  <span class="dt">year</span> = {2017},</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">  <span class="dt">volume</span> = {1},</a>
<a class="sourceLine" id="cb33-7" data-line-number="7">  <span class="dt">pages</span> = {24--57},</a>
<a class="sourceLine" id="cb33-8" data-line-number="8">  <span class="dt">publisher</span> = {MIT Press},</a>
<a class="sourceLine" id="cb33-9" data-line-number="9">  <span class="dt">url</span> = {doi:10.1162/CPSY_a_00002},</a>
<a class="sourceLine" id="cb33-10" data-line-number="10">}</a></code></pre></div>
</div>
<div id="papers-citing-hbayesdm" class="section level2">
<h2 class="hasAnchor">
<a href="#papers-citing-hbayesdm" class="anchor"></a>Papers citing hBayesDM</h2>
<p>Here is a selected list of papers being we know that used or cited hBayesDM (from Google Scholar). Let us know if you used hBayesDM for your papers!</p>
<ul>
<li><a href="https://scholar.google.co.kr/scholar?oi=bibs&amp;hl=en&amp;cites=14115085235970942065&amp;as_sdt=5">Papers citing hBayesDM (Google Scholar)</a></li>
</ul>
</div>
<div id="suggested-reading" class="section level2">
<h2 class="hasAnchor">
<a href="#suggested-reading" class="anchor"></a>Suggested reading</h2>
<p>You can refer to other helpful review papers or books <span class="citation">(Busemeyer &amp; Diederich, 2010; Daw, 2011; Lee, 2011; Lee &amp; Wagenmakers, 2014; Shiffrin et al., 2008)</span> to know more about HBA or computational modeling in general.</p>
</div>
<div id="other-useful-links" class="section level2">
<h2 class="hasAnchor">
<a href="#other-useful-links" class="anchor"></a>Other Useful Links</h2>
<ol style="list-style-type: decimal">
<li>“Modelling behavioural data” by Quentin Huys, available in <a href="https://www.quentinhuys.com/teaching.html" class="uri">https://www.quentinhuys.com/teaching.html</a>.</li>
<li>Introductory tutorial on reinforcment learning by Jill O’Reilly and Hanneke den Ouden, available in <a href="http://hannekedenouden.ruhosting.nl/RLtutorial/Instructions.html" class="uri">http://hannekedenouden.ruhosting.nl/RLtutorial/Instructions.html</a>.</li>
<li>VBA Toolbox: A flexible modeling (MATLAB) toolbox using Variational Bayes (<a href="http://mbb-team.github.io/VBA-toolbox/" class="uri">http://mbb-team.github.io/VBA-toolbox/</a>).</li>
<li>TAPAS: A collection of algorithms and software tools written in MATLAB. Developed by the Translational Neuromodeling Unit (TNU) at Zurich (<a href="http://www.translationalneuromodeling.org/tapas/" class="uri">http://www.translationalneuromodeling.org/tapas/</a>).</li>
<li>Bayesian analysis toolbox for delay discounting data, available in <a href="http://www.inferencelab.com/delay-discounting-analysis/" class="uri">http://www.inferencelab.com/delay-discounting-analysis/</a>.</li>
<li>rtdists: Response time distributions in R, available in <a href="https://github.com/rtdists/rtdists/" class="uri">https://github.com/rtdists/rtdists/</a>.</li>
<li>RWiener: Wiener process distribution functions, available in <a href="https://cran.r-project.org/web/packages/RWiener/index.html" class="uri">https://cran.r-project.org/web/packages/RWiener/index.html</a>.</li>
</ol>
</div>
<div id="acknoledgement" class="section level2">
<h2 class="hasAnchor">
<a href="#acknoledgement" class="anchor"></a>Acknoledgement</h2>
<p>This work was supported in part by the National Institute on Drug Abuse (NIDA) under award number R01DA021421 (PI: Jasmin Vassileva).</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<!-- See here to learn how to cite references: 
http://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html 

## for table of contents
http://stackoverflow.com/questions/23957278/how-to-add-table-of-contents-in-rmarkdown
-->
<div id="refs" class="references">
<div id="ref-ahn2011model">
<p>Ahn, W.-Y., Krawitz, A., Kim, W., Busemeyer, J. R., &amp; Brown, J. W. (2011). A model-based fMRI analysis with hierarchical bayesian parameter estimation. <em>Journal of Neuroscience, Psychology, and Economics</em>, <em>4</em>(2), 95.</p>
</div>
<div id="ref-ahn2014decision">
<p>Ahn, W.-Y., Vasilev, G., Lee, S.-H., Busemeyer, J. R., Kruschke, J. K., Bechara, A., &amp; Vassileva, J. (2014). Decision-making in stimulant and opiate addicts in protracted abstinence: Evidence from computational modeling with pure users. <em>Frontiers in Psychology</em>, <em>5</em>, 849.</p>
</div>
<div id="ref-Busemeyer2010">
<p>Busemeyer, J. R., &amp; Diederich, A. (2010). <em>Cognitive modeling</em>. Sage Publications, Inc.</p>
</div>
<div id="ref-Busemeyer2000a">
<p>Busemeyer, J. R., &amp; Wang, Y.-M. (2000). Model comparisons and model selections based on generalization criterion methodology. <em>Journal of Mathematical Psychology</em>, <em>44</em>, 171–189.</p>
</div>
<div id="ref-daw2011trial">
<p>Daw, N. D. (2011). Trial-by-trial data analysis using computational models. <em>Decision Making, Affect, and Learning: Attention and Performance XXIII</em>, <em>23</em>, 3–38.</p>
</div>
<div id="ref-huys2011disentangling">
<p>Huys, Q. J. M., Cools, R., Gölzer, M., Friedel, E., Heinz, A., Dolan, R. J., &amp; Dayan, P. (2011). Disentangling the roles of approach, activation and valence in instrumental and pavlovian responding. <em>PLoS Computational Biology</em>, <em>7</em>(4), e1002028.</p>
</div>
<div id="ref-kruschke2014doing">
<p>Kruschke, J. (2014). <em>Doing bayesian data analysis: A tutorial with R, JAGS, and Stan</em>. Academic Press.</p>
</div>
<div id="ref-Lee2011hba">
<p>Lee, M. D. (2011). How cognitive modeling can benefit from hierarchical bayesian models. <em>Journal of Mathematical Psychology</em>, <em>55</em>(1), 1–7.</p>
</div>
<div id="ref-lee2014bayesian">
<p>Lee, M. D., &amp; Wagenmakers, E.-J. (2014). <em>Bayesian cognitive modeling: A practical course</em>. Cambridge University Press.</p>
</div>
<div id="ref-mathys2011bayesian">
<p>Mathys, C., Daunizeau, J., Friston, K. J., &amp; Stephan, K. E. (2011). A bayesian foundation for individual learning under uncertainty. <em>Frontiers in Human Neuroscience</em>, <em>5</em>, 39.</p>
</div>
<div id="ref-newman1986passive">
<p>Newman, J. P., &amp; Kosson, D. S. (1986). Passive avoidance learning in psychopathic and nonpsychopathic offenders. <em>Journal of Abnormal Psychology</em>, <em>95</em>(3), 252.</p>
</div>
<div id="ref-Newman1985">
<p>Newman, J. P., Widom, C. S., &amp; Nathan, S. (1985). Passive avoidance in syndromes of disinhibition, psychopathy, and extraversion. <em>Journal of Personality and Individual Differences</em>, <em>48</em>, 1316–1327.</p>
</div>
<div id="ref-o2007model">
<p>O’Doherty, J. P., Hampton, A., &amp; Kim, H. (2007). Model-based fMRI and its application to reward learning and decision making. <em>Annals of the New York Academy of Sciences</em>, <em>1104</em>(1), 35–53.</p>
</div>
<div id="ref-Shiffrin2008">
<p>Shiffrin, R., Lee, M. D., Kim, W., &amp; Wagenmakers, E. (2008). A survey of model evaluation approaches with a tutorial on hierarchical Bayesian methods. <em>Cognitive Science: A Multidisciplinary Journal</em>, <em>32</em>(8), 1248–1284.</p>
</div>
<div id="ref-steingroever2014absolute">
<p>Steingroever, H., Wetzels, R., &amp; Wagenmakers, E.-J. (2014). Absolute performance of reinforcement-learning models for the iowa gambling task. <em>Decision</em>, <em>1</em>(3), 161.</p>
</div>
<div id="ref-vehtari2015e">
<p>Vehtari, A., Gelman, A., &amp; Gabry, J. (2015). Efficient implementation of leave-one-out cross-validation and WAIC for evaluating fitted Bayesian models. <em>arXiv Preprint arXiv:1507.04544</em>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#motivation">Motivation</a></li>
      <li><a href="#why-hierarchical-bayesian-analysis-hba">Why hierarchical Bayesian analysis (HBA)?</a></li>
      <li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#tasks-models-implemented-in-hbayesdm">Tasks &amp; models implemented in hBayesDM</a></li>
      <li>
<a href="#how-to-install-hbayesdm">How to install hBayesDM</a><ul class="nav nav-pills nav-stacked">
<li><a href="#method-a-recommended-for-all-users---windowsmaclinux">Method A (recommended for all users - Windows/Mac/Linux)</a></li>
      <li><a href="#method-b">Method B</a></li>
      <li><a href="#method-c">Method C</a></li>
      <li><a href="#precompiling-stan-models-during-installation">Precompiling Stan models during installation</a></li>
      </ul>
</li>
      <li>
<a href="#how-to-use-hbayesdm">How to use hBayesDM</a><ul class="nav nav-pills nav-stacked">
<li><a href="#prepare-the-data">1) Prepare the data</a></li>
      <li><a href="#fit-candidate-models">2) Fit candidate models</a></li>
      <li><a href="#plot-model-parameters">3) Plot model parameters</a></li>
      <li><a href="#compare-models-and-groups">4) Compare models (and groups)</a></li>
      <li><a href="#extracting-trial-by-trial-regressors-for-model-based-fmrieeg-analysis">5) Extracting trial-by-trial regressors for model-based fMRI/EEG analysis</a></li>
      <li><a href="#variational-inference-for-approximate-posterior-sampling">6) Variational inference for approximate posterior sampling</a></li>
      <li><a href="#posterior-predictive-checks">7) Posterior predictive checks</a></li>
      </ul>
</li>
      <li><a href="#to-do-list">To-do list</a></li>
      <li><a href="#citation">Citation</a></li>
      <li><a href="#papers-citing-hbayesdm">Papers citing hBayesDM</a></li>
      <li><a href="#suggested-reading">Suggested reading</a></li>
      <li><a href="#other-useful-links">Other Useful Links</a></li>
      <li><a href="#acknoledgement">Acknoledgement</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Woo-Young Ahn, Nate Haines, Lei Zhang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
